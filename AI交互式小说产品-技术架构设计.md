# AI交互式小说产品 - 技术架构设计文档

## 产品概述

### 核心功能
1. 通过AI生成小说内容
2. 每个章节生成影响故事发展的节点，提供3个AI生成选择给用户
3. 用户可以选择AI提供的选项，也可以自己输入自定义选择
4. 用户选择真实影响故事发展方向

### 产品价值
- **创作民主化**：让普通用户参与高质量内容创作
- **AI协作新模式**：探索人机协作创作的可能性
- **个性化体验**：每个用户都能获得独一无二的故事体验
- **娱乐形式创新**：创造介于游戏和小说之间的新娱乐形式

## 技术架构设计

### 1. AI模型选择

**开发阶段：Gemini**
- 优势：Google提供免费额度，适合早期开发调试
- 性能：Gemini 1.5 Pro创作能力强，中文支持良好
- 成本：开发阶段无需担心API费用

**生产阶段考虑：**
- 主力模型：Claude 3.5 Sonnet 或 GPT-4（高质量）
- 备选方案：GPT-3.5 + 质量优化（低成本）

### 2. 故事风格设计

**MVP阶段三种风格：**

#### 修仙风格
- 选择特色：修炼路线 / 人际关系 / 冒险探索
- 典型元素：天赋测试、功法传承、门派关系、境界突破

#### 武侠风格  
- 选择特色：正义路线 / 情感路线 / 智谋路线
- 典型元素：江湖初入、武功传承、恩怨纠葛、侠义精神

#### 科技风格
- 选择特色：技术路线 / 人文路线 / 探索路线
- 典型元素：未来觉醒、科技发现、星际探索、道德选择

### 3. 故事结构设计

**故事长度：15-20章**
- 避免体验过短，保证用户投入感
- 足够长度支持复杂的后果延迟机制

**章节结构：**
```
章节1-5：  详细记录所有元素，埋下种子
章节6-10： 开始激活早期元素，发展主线
章节11-15：高潮阶段，多线汇聚
章节16-20：结局阶段，后果显现
```

### 4. 选择生成算法

**核心思路：风格化选择生成**

```
输入：当前章节内容 + 故事总结 + 风格设定
↓
分析：当前情节的关键转折点
↓  
生成：3个符合风格特色的选择方向
```

**算法要求：**
- 确保选择的差异性（代表不同价值观和发展方向）
- 保持风格一致性（使用专门的prompt模板）
- 处理用户自定义输入（理解意图并融入对应风格）

### 5. 故事状态管理系统

**分层总结系统：**
```json
{
  "chapterSummary": {
    "plotProgress": "剧情发展要点",
    "characterChanges": "角色状态变化", 
    "worldState": "世界观/环境变化",
    "userChoice": "用户选择及其影响",
    "nextHooks": "为下章埋下的伏笔"
  },
  "stageSummary": "每5章的阶段性总结",
  "globalSummary": "全局故事脉络"
}
```

**元素追踪系统：**
```json
{
  "storyElements": {
    "characters": [
      {
        "name": "路边小贩",
        "chapter": 1,
        "importance": "minor",
        "futureRole": "potential_key_character",
        "traits": ["善良", "神秘", "有故事"]
      }
    ],
    "items": [...],
    "locations": [...],
    "events": [...]
  }
}
```

**因果链管理：**
- 记录用户选择与后果的关联关系
- 支持"后果延迟"机制
- 追踪长期影响的实现

### 6. 后果延迟机制

**核心特性：**
- 第1章的不起眼角色可在第10章重要出现
- 早期选择的影响在后期章节显现
- AI主动检索早期元素，寻找重新激活机会

**实现方式：**
- 种子系统：每章埋下可能重要的元素
- 激活机制：后续章节检索并激活种子
- 选择影响：用户选择决定哪些种子被激活

### 7. 自由结局系统

**设计理念：**
- 不预设结局类型，让故事自然发展
- 真实的选择后果，无论好坏都接受
- 主角暴毙都是可能的结局
- 体现选择的真实重量和故事的自由度

**技术要求：**
- AI不会刻意"拯救"主角
- 不强行制造happy ending
- 让故事发展到逻辑终点

### 8. 用户自定义输入处理

**处理流程：**
```
用户输入："我想和那个神秘人合作"
↓
AI理解：选择合作路线，而非对抗
↓  
风格转换：
- 修仙风格："决定与这位前辈结盟，共同探索古迹"
- 武侠风格："选择与这位高手联手，行走江湖"  
- 科技风格："决定与这个未知实体建立合作协议"
```

## 技术挑战与解决方案

### 主要挑战
1. **上下文管理**：15-20章长度的信息保持
2. **逻辑一致性**：确保故事前后不矛盾
3. **后果延迟**：长期因果关系的管理
4. **质量控制**：AI生成内容的稳定性

### 解决方案
1. **分层摘要**：压缩历史信息，保留关键内容
2. **关键信息提取**：只保留对后续发展重要的信息
3. **向量数据库**：用embedding存储故事历史，按需检索
4. **质量过滤**：内容审核和逻辑检查机制

## MVP实现策略

### 保持的核心创新
- ✅ 完全AI生成：不用固定模板，让AI自由创作
- ✅ 真实选择影响：用户选择真正改变故事
- ✅ 无限可能性：每个故事都是独特的

### 简化的实现
- 🔧 专注三种风格：修仙、武侠、科技
- 🔧 故事长度控制：15-20章
- 🔧 质量保证：简单的内容过滤机制

## 下一步计划

1. **用户体验设计**：界面设计、交互流程
2. **质量保证机制**：内容审核、故事质量控制
3. **商业模式探索**：盈利方式、用户获取策略
4. **技术原型开发**：基于Gemini的MVP实现

---

*文档创建时间：2025年*
*讨论参与者：产品构思者 & Sean(deepractice.ai)*
